<!DOCTYPE html>
<html lang="en-US">
  <head>
    <link rel="stylesheet" href="/css/flexbox.css">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="/socket.io/socket.io.js"></script>
    <title>Movie Dashboard</title>
  </head>
  <body>
    <script>
        var socket = io();
        socket.on('connect', function (data) {
            socket.emit('join');
        });
        socket.on('now_playing_info', function(data) {
            console.log(data)
            document.getElementById("now_playing_title").innerHTML=data.title;

            document.getElementById("now_playing_subtitle").innerHTML=data.subtitle;

            document.getElementById("now_playing_link").href=data.link

            document.getElementById("now_playing_poster").src=data.poster;

            if(data.title == "Nothing Currently Playing")
                document.getElementById("now_playing_poster").alt = ""
            else
                document.getElementById("now_playing_poster").alt = data + " Poster"

            var genre_container = document.getElementById("genre_container")
            while (genre_container.hasChildNodes()) {
                genre_container.removeChild(genre_container.lastChild);
            }

            if(data.genres)
                data.genres.forEach(function(genre){
                    var tag = document.createElement("h6")
                    var text = document.createTextNode(genre)
                    tag.appendChild(text)
                    genre_container.appendChild(tag)
                })
        })
        socket.on('watch_history', function(movies) {
            var watch_history = document.getElementById("watch_history")
            while (watch_history.hasChildNodes()) {
                watch_history.removeChild(watch_history.lastChild);
            }

            if(movies)
            {
                movies.forEach(function(movie){
                    var tag = document.createElement("img")
                    tag.src = movie.poster
                    watch_history.appendChild(tag)
                })
            }
        })
    </script>
    <div>
        <fieldset>
            <legend>Now Playing</legend>
            <div>
                <a id="now_playing_link" href="">
                    <img class="child" id="now_playing_poster"></img>
                </a>
                <div class="child now-playing-info">
                    <h2 id="now_playing_title"> </h2>
                    <h3 id="now_playing_subtitle"></h3>
                    <div id="genre_container"></div>
                </div>
            </div>
         </fieldset>
         <fieldset>
            <legend>Watch History</legend>
            <div id="watch_history" class="flex-container">
            </div>
        </fieldset>
    </div>
  </body>
</html>
<!--http://image.tmdb.org/t/p/w154/3wAsfLbGVa3Nb1zBzdOUwttxtjZ.jpg-->