<!DOCTYPE html>
<html lang="en-US">
  <head>
    <link rel="stylesheet" href="/css/carousel.css">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <title>Movie Dashboard</title>
  </head>
  <body>
    <script>
        var socket = io();
        socket.on('connect', function (data) {
            socket.emit('join');
        });
        socket.on('now_playing_info', function(data) {
            console.log(data)
            document.getElementById("now_playing_title").innerHTML=data.title;

            document.getElementById("now_playing_subtitle").innerHTML=data.subtitle;

            document.getElementById("now_playing_link").href=data.link

            document.getElementById("now_playing_poster").src=data.poster;

            if(data.title == "Nothing Currently Playing")
                document.getElementById("now_playing_poster").alt = ""
            else
                document.getElementById("now_playing_poster").alt = data + " Poster"

            var genre_container = document.getElementById("genre_container")
            while (genre_container.hasChildNodes()) {
                genre_container.removeChild(genre_container.lastChild);
            }

            if(data.genres)
                data.genres.forEach(function(genre){
                    var tag = document.createElement("h6")
                    var text = document.createTextNode(genre)
                    tag.appendChild(text)
                    genre_container.appendChild(tag)
                })
        })
        socket.on('watch_history', function(movies) {
            var watch_history = document.getElementById("watch-history")
            while (watch_history.hasChildNodes()) {
                watch_history.removeChild(watch_history.lastChild);
            }

            if(movies)
            {
                let count = 0
                movies.forEach(function(movie){
                    var tag = document.createElement("img")
                    tag.classList.add("carousel-image")
                    if(count > 7)
                        tag.classList.add("hidden")

                    tag.src = movie.poster
                    tag.alt = movie.name
                    watch_history.appendChild(tag)
                    count++
                })
            }
        })        

        $(document).ready(function(){
            $('.carousel-image').hover(function() {
                $(this).addClass('transition')
    
            }, function() {
                $(this).removeClass('transition')
            });
        });

        $(document).on('click', '#icon_right, #icon_left', function() {
            if($(this).attr('id') == 'icon_right') {
                $('.inner-carousel').animate({scrollLeft: 1000}, 800);
                } else {
                $('.inner-carousel').animate({scrollLeft: -1000}, 800);
            }
        });
    </script>
    <div>
        <fieldset>
            <legend>Now Playing</legend>
            <div>
                <a id="now_playing_link" href="">
                    <img class="child" id="now_playing_poster"></img>
                </a>
                <div class="child now-playing-info">
                    <h2 id="now_playing_title"> </h2>
                    <h3 id="now_playing_subtitle"></h3>
                    <div id="genre_container"></div>
                </div>
            </div>
         </fieldset>
         <fieldset>
            <legend>Watch History</legend>
            <div class="outer-carousel">
                <i id='icon_left' class='arrow left'></i>
                <div id="watch-history" class="inner-carousel"></div>
                <i id='icon_right' class='arrow right'></i>
            </div>
        </fieldset>
    </div>
  </body>
</html>